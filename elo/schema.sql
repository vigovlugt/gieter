-- D1 schema for gieter-elo
-- Run: bunx wrangler d1 execute gieter-elo --local --file=schema.sql
-- Deploy: bunx wrangler d1 execute gieter-elo --remote --file=schema.sql

CREATE TABLE IF NOT EXISTS listings (
  ref      TEXT PRIMARY KEY,
  elo      REAL NOT NULL DEFAULT 1000,
  wins     INTEGER NOT NULL DEFAULT 0,
  losses   INTEGER NOT NULL DEFAULT 0,
  matches  INTEGER NOT NULL DEFAULT 0
);

CREATE TABLE IF NOT EXISTS votes (
  id          INTEGER PRIMARY KEY AUTOINCREMENT,
  winner_ref  TEXT NOT NULL,
  loser_ref   TEXT NOT NULL,
  voter_name  TEXT NOT NULL,
  created_at  TEXT NOT NULL DEFAULT (datetime('now'))
);

-- Seed top 50 listings at ELO 1000 (idempotent)
INSERT OR IGNORE INTO listings (ref) VALUES ('01G25050');
INSERT OR IGNORE INTO listings (ref) VALUES ('61G972');
INSERT OR IGNORE INTO listings (ref) VALUES ('H36G015830');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G025528');
INSERT OR IGNORE INTO listings (ref) VALUES ('76G1534');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G030165');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G025120');
INSERT OR IGNORE INTO listings (ref) VALUES ('H36G020865');
INSERT OR IGNORE INTO listings (ref) VALUES ('H28G024484');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G020711');
INSERT OR IGNORE INTO listings (ref) VALUES ('35G14124');
INSERT OR IGNORE INTO listings (ref) VALUES ('60G602226');
INSERT OR IGNORE INTO listings (ref) VALUES ('52G369');
INSERT OR IGNORE INTO listings (ref) VALUES ('61G61019');
INSERT OR IGNORE INTO listings (ref) VALUES ('69G1404');
INSERT OR IGNORE INTO listings (ref) VALUES ('59G592396');
INSERT OR IGNORE INTO listings (ref) VALUES ('H88G000331');
INSERT OR IGNORE INTO listings (ref) VALUES ('61G873');
INSERT OR IGNORE INTO listings (ref) VALUES ('H18G025556');
INSERT OR IGNORE INTO listings (ref) VALUES ('71G3146');
INSERT OR IGNORE INTO listings (ref) VALUES ('22G521112');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G21476');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G31165');
INSERT OR IGNORE INTO listings (ref) VALUES ('42G3284');
INSERT OR IGNORE INTO listings (ref) VALUES ('76G6085');
INSERT OR IGNORE INTO listings (ref) VALUES ('H21G028245');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G020636');
INSERT OR IGNORE INTO listings (ref) VALUES ('59G592482');
INSERT OR IGNORE INTO listings (ref) VALUES ('62G1240');
INSERT OR IGNORE INTO listings (ref) VALUES ('51G671');
INSERT OR IGNORE INTO listings (ref) VALUES ('H88G030971');
INSERT OR IGNORE INTO listings (ref) VALUES ('H89G028683');
INSERT OR IGNORE INTO listings (ref) VALUES ('35G13094');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G022638');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G21689');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G1982');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G51251');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G31657');
INSERT OR IGNORE INTO listings (ref) VALUES ('03G51262');
INSERT OR IGNORE INTO listings (ref) VALUES ('59G592265');
INSERT OR IGNORE INTO listings (ref) VALUES ('02G022109');
INSERT OR IGNORE INTO listings (ref) VALUES ('60G602104');
INSERT OR IGNORE INTO listings (ref) VALUES ('76G9331');
INSERT OR IGNORE INTO listings (ref) VALUES ('76G5149');
INSERT OR IGNORE INTO listings (ref) VALUES ('H88G029475');
INSERT OR IGNORE INTO listings (ref) VALUES ('H88G004558');
INSERT OR IGNORE INTO listings (ref) VALUES ('H89G028838');
INSERT OR IGNORE INTO listings (ref) VALUES ('41G1305');
INSERT OR IGNORE INTO listings (ref) VALUES ('H53G010962');
INSERT OR IGNORE INTO listings (ref) VALUES ('59G592445');
